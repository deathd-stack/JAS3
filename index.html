<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>JAS MEMO VER 1.2.X</title>

<style>
body{
  margin:0;
  background:#ff9f1c;
  font-family:system-ui;
  font-size:1.15rem;
  font-weight:600;
}
header{
  text-align:center;
  padding:16px;
  font-size:2.1rem;
  font-weight:900;
  cursor:pointer;
}
.controls{
  display:flex;
  gap:10px;
  justify-content:center;
}
button{
  padding:14px 18px;
  border:none;
  border-radius:12px;
  background:#fff;
  font-weight:900;
  font-size:1.5rem;
}
#memoList{padding:12px;}
.memo{
  background:#fff;
  border-radius:14px;
  padding:12px;
  margin-bottom:10px;
  display:flex;
  gap:10px;
  align-items:center;
}
.memo-title{
  font-weight:900;
  cursor:pointer;
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  justify-content:center;
  align-items:center;
}
.box{
  background:#fff;
  width:95%;
  max-height:90vh;
  overflow:auto;
  border-radius:16px;
  padding:16px;
}
.row{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-bottom:6px;
}
input{
  width:64px;
  text-align:center;
  font-weight:800;
  font-size:1rem;
}
.cmpt{
  display:flex;
  gap:8px;
  margin-bottom:4px;
}
.cmpt input{
  width:120px;
}
.cmpt label{width:90px;}
.red{
  color:red;
  font-weight:900;
  cursor:pointer;
  margin-bottom:8px;
}
textarea{
  width:100%;
  height:70px;
  font-weight:700;
  margin-top:6px;
}
.section-title{
  font-weight:900;
  margin-top:12px;
}
.hidden{display:none}

/* 사진 */
#photoLayer{
  position:fixed;
  inset:0;
  background:black;
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999;
}
#photoLayer img{
  max-width:100%;
  max-height:100%;
  transform:scale(1);
}
</style>
</head>

<body>

<header onclick="openPhoto()">JAS MEMO VER 1.2.X</header>

<div class="controls">
  <button onclick="newMemo()">메모 추가</button>
  <button onclick="deleteSelected()">메모 삭제</button>
  <button onclick="addPhoto()">사진 추가</button>
</div>

<div id="memoList"></div>

<input type="file" id="photoInput" accept="image/*" hidden>

<!-- 메모 모달 -->
<div class="modal" id="modal">
<div class="box">
  <div class="row">
    <label><input type="checkbox" id="inChk">INBOUND</label>
    <label style="margin-left:20px"><input type="checkbox" id="outChk">OUTBOUND</label>
  </div>

  <div class="red" id="time" onclick="setTime()" ondblclick="editTime()">--:--</div>

  <div id="sections"></div>

  <textarea id="note" placeholder="특이사항"></textarea>

  <div class="row">
    <button onclick="saveMemo()">저장</button>
    <button onclick="closeModal()">닫기</button>
  </div>
</div>
</div>

<!-- 사진 -->
<div id="photoLayer" ondblclick="closePhoto()">
  <img id="photoImg">
</div>

<script>
let memos=JSON.parse(localStorage.getItem("jas_memos")||"[]");
let editId=null;
let photo=localStorage.getItem("jas_photo")||null;
let scale=1;

/* 숫자 자동 이동 */
document.addEventListener("input",e=>{
  if(e.target.tagName!=="INPUT")return;
  if(e.target.dataset.hl==="in"){
    const out=document.querySelector('[data-hl="out"]');
    if(out) out.value=e.target.value;
  }
  const max=e.target.maxLength;
  if(max>0 && e.target.value.length>=max){
    const inputs=[...document.querySelectorAll("input")];
    const i=inputs.indexOf(e.target);
    if(inputs[i+1]) inputs[i+1].focus();
  }
});

function newMemo(){
  editId=null;
  modal.style.display="flex";
  inChk.checked=false;
  outChk.checked=false;
  time.textContent="--:--";
  sections.innerHTML="";
  note.value="";
}

function closeModal(){modal.style.display="none";}

inChk.onchange=outChk.onchange=renderSections;

function renderSections(){
  sections.innerHTML="";
  if(inChk.checked) sections.innerHTML+=section("INBOUND");
  if(outChk.checked) sections.innerHTML+=section("OUTBOUND");
}

function section(type){
return `
<div class="section-title">${type}</div>
<div class="row">
<label>7C</label><input maxlength="4" data-k="${type}-c7">
<label>HL</label><input maxlength="4" data-k="${type}-hl" data-hl="${type==='INBOUND'?'in':'out'}">
</div>
${[1,2,3,4].map(i=>`
<div class="cmpt">
<label>CMPT ${i}</label>
<input data-k="${type}-cmpt${i}">
<input data-k="${type}-cmpt${i}-b">
</div>`).join("")}
<div class="row">
<label>T</label><input maxlength="3" data-k="${type}-t">
<label>D</label><input maxlength="2" data-k="${type}-d">
<label>B</label><input maxlength="2" data-k="${type}-b">
</div>
<div class="row">
<label>W</label><input maxlength="2" data-k="${type}-w">
<label>C</label><input maxlength="3" data-k="${type}-c">
<label>COB</label><input maxlength="3" data-k="${type}-cob">
</div>
`;
}

function setTime(){
const d=new Date();
time.textContent=d.toLocaleTimeString("ko-KR",{hour12:false,hour:"2-digit",minute:"2-digit"});
}
function editTime(){
const t=prompt("시간 수정",time.textContent);
if(t) time.textContent=t;
}

function saveMemo(){
const data={id:editId??Date.now(),time:time.textContent,note:note.value};
document.querySelectorAll("[data-k]").forEach(i=>data[i.dataset.k]=i.value);
if(editId){
const idx=memos.findIndex(m=>m.id===editId);
memos[idx]=data;
}else memos.push(data);
localStorage.setItem("jas_memos",JSON.stringify(memos));
closeModal(); renderList();
}

function renderList(){
memoList.innerHTML="";
memos.forEach(m=>{
let title="";
if(m["INBOUND-c7"]) title+=`IN 7C[${m["INBOUND-c7"]}] HL[${m["INBOUND-hl"]}] `;
if(m["OUTBOUND-c7"]) title+=`OUT 7C[${m["OUTBOUND-c7"]}]`;
memoList.innerHTML+=`
<div class="memo">
<input type="checkbox">
<div class="memo-title" onclick="editMemo(${m.id})">${title}</div>
</div>`;
});
}

function editMemo(id){
editId=id;
const m=memos.find(x=>x.id===id);
modal.style.display="flex";
time.textContent=m.time;
note.value=m.note||"";
inChk.checked=!!m["INBOUND-c7"];
outChk.checked=!!m["OUTBOUND-c7"];
renderSections();
document.querySelectorAll("[data-k]").forEach(i=>{
i.value=m[i.dataset.k]||"";
});
}

function deleteSelected(){
const checks=[...document.querySelectorAll(".memo input")];
memos=memos.filter((_,i)=>!checks[i].checked);
localStorage.setItem("jas_memos",JSON.stringify(memos));
renderList();
}

/* 사진 */
function addPhoto(){
  photoInput.click();
}
photoInput.onchange=e=>{
  const f=e.target.files[0];
  if(!f) return;
  const r=new FileReader();
  r.onload=()=>{
    photo=r.result;
    localStorage.setItem("jas_photo",photo);
  };
  r.readAsDataURL(f);
};

function openPhoto(){
  if(!photo) return;
  photoImg.src=photo;
  scale=1;
  photoImg.style.transform="scale(1)";
  photoLayer.style.display="flex";
}
function closePhoto(){
  photoLayer.style.display="none";
  scale=1;
  photoImg.style.transform="scale(1)";
}

photoLayer.onwheel=e=>{
  e.preventDefault();
  scale+=e.deltaY<0?0.1:-0.1;
  scale=Math.max(1,Math.min(scale,4));
  photoImg.style.transform=`scale(${scale})`;
};

renderList();
</script>

</body>
</html>
